function getContextPath(){var e=document.location.pathname,r=e.substr(1).indexOf("/"),t=e.substr(0,r+1);return t}jQuery(function($){$(document).on("click",".toolbar a[data-target]",function(e){e.preventDefault();var r=$(this).data("target");$(".widget-box.visible").removeClass("visible"),$(r).addClass("visible")}),$("#btn-login-dark").on("click",function(e){$("body").attr("class","login-layout"),e.preventDefault()}),$("#btn-login-light").on("click",function(e){$("body").attr("class","login-layout light-login"),e.preventDefault()}),$("#btn-login-blur").on("click",function(e){$("body").attr("class","login-layout blur-login"),e.preventDefault()}),$("#retrieveButton").bind("click",function(){$("#validationRetrieveForm").submit()}),$("#validationRetrieveForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{email:{required:!0,email:!0}},messages:{email:{required:"请填写邮箱",email:"请填写正确的邮箱"}},highlight:function(e){$(e).closest("label").removeClass("has-info").addClass("has-error")},success:function(e){$(e).closest("label").removeClass("has-error"),$(e).remove()},errorPlacement:function(e,r){e.insertAfter(r.parent())},submitHandler:function(form){$.ajax({dataType:"json",url:getContextPath()+"/sys/sysuser/retrievePassword",type:"post",data:{email:$("#retrieveEmail").val()},complete:function(xmlRequest){var returninfo=eval("("+xmlRequest.responseText+")");1==returninfo.result?$("#retrieveTip").html("找回密码邮件已经发到你的邮箱"):-1==returninfo.result&&$("#retrieveTip").html("密保邮箱不存在，请重新输入")}})},invalidHandler:function(){}}),$(document).keydown(function(e){var r=window.event?e.keyCode:e.which;13==r&&$("#validationLoginForm").submit()}),$("#loginButton").bind("click",function(){$("#validationLoginForm").submit()}),$("#validationLoginForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{email:{required:!0,email:!0},password:{required:!0,minlength:6,maxlength:14}},messages:{email:{required:"请填写邮箱",email:"请填写正确的邮箱"},password:{required:"请输入密码",minlength:"密码长度至少为6个字符",maxlength:"密码长度至多为14个字符"}},highlight:function(e){$(e).closest("label").removeClass("has-info").addClass("has-error")},success:function(e){$(e).closest("label").removeClass("has-error"),$(e).remove()},errorPlacement:function(e,r){e.insertAfter(r.parent())},submitHandler:function(form){$.ajax({dataType:"json",url:getContextPath()+"/sys/sysuser/login",type:"post",data:{email:$("#loginEmail").val(),password:$("#loginPassword").val()},complete:function(xmlRequest){var returninfo=eval("("+xmlRequest.responseText+")");1==returninfo.result?document.location.href=getContextPath()+"/sys/sysuser/home":$("#loginTip").html(-1==returninfo.result?"用户名有误或已被禁用":-2==returninfo.result?"密码错误":"服务器错误")}})},invalidHandler:function(){}}),$("[data-rel=tooltip]").tooltip({container:"body"}),$("#birthday").datepicker({format:"yyyy-mm-dd",language:"zh-CN"}),$("#registerButton").bind("click",function(){$("#validationRegisterForm").submit()}),$("#validationRegisterForm").validate({errorElement:"div",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{userName:{required:!0,maxlength:40},sex:{required:!0},email:{required:!0,email:!0,maxlength:30},phone:{required:!1,maxlength:20},birthday:{required:!1},password:{required:!0,minlength:6,maxlength:14},repeatPassword:{required:!0,minlength:6,maxlength:14,equalTo:"#password"},agree:{required:!0}},messages:{userName:{required:"请填写姓名",maxlength:"姓名长度至多为40个字符"},sex:"请选择性别",email:{required:"请填写邮箱",email:"请填写正确的邮箱",maxlength:"邮箱长度至多为30个字符"},phone:{required:"请填写联系电话",maxlength:"联系电话长度至多为20个字符"},password:{required:"请输入密码",minlength:"密码长度至少为6个字符",maxlength:"密码长度至多为14个字符"},repeatPassword:{required:"请输入确认密码",minlength:"确认密码长度至少为6个字符",maxlength:"确认密码长度至多为14个字符",equalTo:"密码和确认密码不一致"},agree:"您还未接受用户协议"},highlight:function(e){$(e).closest("label").removeClass("has-info").addClass("has-error")},success:function(e){$(e).closest("label").removeClass("has-error"),$(e).remove()},errorPlacement:function(e,r){e.insertAfter(r.parent())},submitHandler:function(form){$.ajax({dataType:"json",url:getContextPath()+"/sys/sysuser/register",type:"post",data:{userName:$("#userName").val(),sex:$("input[name='sex']:checked").val(),email:$("#email").val(),phone:$("#phone").val(),birthday:$("#birthday").val(),password:$("#password").val()},complete:function(xmlRequest){var returninfo=eval("("+xmlRequest.responseText+")");1==returninfo.result?document.location.href=getContextPath()+"/sys/sysuser/home":$("#registerTip").html(-1==returninfo.result?"此邮箱已被注册":"服务器错误")}})},invalidHandler:function(){}})});