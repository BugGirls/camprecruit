<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>智能超市终端</title>
        <meta name="keywords" content="index">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="renderer" content="webkit">
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <meta name="apple-mobile-web-app-title" content="Amaze UI" />
        <link rel="stylesheet" href="../assets/css/amazeui.min.css" />
        <link rel="stylesheet" href="../assets/css/admin.css">
        <link rel="stylesheet" href="../assets/css/app.css">
        <link rel="stylesheet" href="../assets/css/amazeui.cropper.css">
        <link rel="stylesheet" href="../assets/css/custom_up_img.css">
        <script src="../assets/js/echarts.min.js"></script>
        <style>
            .tpl-portlet-components {
                margin-top: -12px;
                border-radius: 10px;
            }

            .tpl-logo img {
                display: block;
                height: 78px;
                width: auto;
            }
            .titleBox p {
                float:left;
                position:relative;
                right:50%;
                color: black;
            }
            .tpl-portlet-components .portlet-title {
                border-bottom: none;
                margin-top: 20px;
            }
            .am-form .checkbox-style {
                width: 17px;
                height: 17px;
            }
            .up-img-cover {
                width: 120px;
                height: 45px;
                cursor: pointer;
                background-color: #eee;
                text-align: center;
                line-height: 45px;
                border-radius: 5px;
                background-color: #23abf0;
                color: #fff;
            }
        </style>
    </head>

    <body data-type="index">
        <header class="am-topbar am-topbar-inverse admin-header">
            <div class="am-topbar-brand">
                <a href="javascript:;" class="tpl-logo">
                    <img src="../assets/img/logo.png">
                </a>
            </div>

            <div class="am-collapse am-topbar-collapse" id="topbar-collapse">
                <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list tpl-header-list">
                    <li class="am-hide-sm-only">
                        <a href="javascript:;" id="admin-fullscreen" class="tpl-header-list-link">
                            <span class="am-icon-arrows-alt"></span>
                            <span class="admin-fullText">开启全屏</span>
                        </a>
                    </li>
                    <li class="am-dropdown" data-am-dropdown data-am-dropdown-toggle>
                        <a class="am-dropdown-toggle tpl-header-list-link" href="javascript:;">
                            <span class="tpl-header-list-user-nick">禁言小张</span><span class="tpl-header-list-user-ico"> <img src="../assets/img/img1.png"></span>
                        </a>
                        <ul class="am-dropdown-content">
                            <li><a href="#"><span class="am-icon-bell-o"></span> 资料</a></li>
                            <li><a href="#"><span class="am-icon-cog"></span> 设置</a></li>
                            <li><a href="#"><span class="am-icon-power-off"></span> 退出</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </header>

        <div class="tpl-page-container tpl-page-header-fixed">
            <div class="tpl-left-nav tpl-left-nav-hover">
                <div class="tpl-left-nav-title">
                    Amaze UI 列表
                </div>
                <div class="tpl-left-nav-list">
                    <ul class="tpl-left-nav-menu">
                        <li class="tpl-left-nav-item">
                            <a href="materialImage.html" class="nav-link active">
                                <i class="am-icon-home"></i>
                                <span>素材管理</span>
                            </a>
                        </li>
                        <li class="tpl-left-nav-item">
                            <a href="poiManager.html" class="nav-link ">
                                <i class="am-icon-home"></i>
                                <span>门店管理</span>
                            </a>
                        </li>
                        <li class="tpl-left-nav-item">
                            <a href="cardManager.html" class="nav-link tpl-left-nav-link-list ">
                                <i class="am-icon-bar-chart"></i>
                                <span>卡券管理</span>
                            </a>
                        </li>
                        <li class="tpl-left-nav-item">
                            <a href="memberCardManager.html" class="nav-link tpl-left-nav-link-list ">
                                <i class="am-icon-bar-chart"></i>
                                <span>会员卡管理</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="tpl-content-wrapper">
                <div class="tpl-portlet-components">
                <!-- 图片上传按钮 -->
                <div class="portlet-title">
                    <div class="caption">
                        <span style="font-size: 24px;margin-left: 20px;">图片</span>
                        <span id="imageCount"></span>
                    </div>
                    <div class="tpl-portlet-input tpl-fz-ml">
                        <div class="portlet-input input-small input-inline">
                            <div class="input-icon right">
                                <div class="up-img-cover" id="up-img-touch">
                                    <span class="am-icon-cloud-upload"></span>
                                    点击上传
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tpl-portlet-input tpl-fz-ml" style="color: #8d8d8d;margin-top: 10px;margin-right: -24px;font-size: 15px;">
                        支持（jpg/ico/gif/png），大小不超过5M
                    </div>
                </div>

                <!--图片上传框-->
                <div class="am-modal am-modal-no-btn up-modal-frame" tabindex="-1" id="up-modal-frame">
                    <div class="am-modal-dialog up-frame-parent up-frame-radius">
                        <div class="am-modal-hd up-frame-header">
                            <label>上传图片</label>
                            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
                        </div>
                        <div class="am-modal-bd  up-frame-body">
                            <div class="am-g am-fl">
                                <div class="am-form-group am-form-file">
                                    <div class="am-fl">
                                        <button type="button" class="am-btn am-btn-default am-btn-sm">
                                            <i class="am-icon-cloud-upload"></i> 选择要上传的文件
                                        </button>
                                    </div>
                                    <input type="file" class="up-img-file">
                                </div>
                            </div>
                            <div class="am-g am-fl">
                                <div class="up-pre-before up-frame-radius">
                                    <img alt="" src="" class="up-img-show" id="up-img-show" >
                                </div>
                                <div class="up-pre-after up-frame-radius">
                                </div>
                            </div>
                            <div class="am-g am-fl">
                                <div class="up-control-btns">
                                    <span class="am-icon-rotate-left" id="up-btn-left"></span>
                                    <span class="am-icon-rotate-right" id="up-btn-right"></span>
                                    <span class="am-icon-check up-btn-ok" url="/wechat/manager/upload_material_image" parameter="{width:'100',height:'100'}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--加载框-->
                <div class="am-modal am-modal-loading am-modal-no-btn" tabindex="-1" id="up-modal-loading">
                    <div class="am-modal-dialog">
                        <div class="am-modal-hd">正在上传...</div>
                        <div class="am-modal-bd">
                            <span class="am-icon-spinner am-icon-spin"></span>
                        </div>
                    </div>
                </div>

                <!--警告框-->
                <div class="am-modal am-modal-alert" tabindex="-1" id="up-modal-alert">
                    <div class="am-modal-dialog">
                        <div class="am-modal-hd">信息</div>
                        <div class="am-modal-bd"  id="alert_content">
                            成功了
                        </div>
                        <div class="am-modal-footer">
                            <span class="am-modal-btn">确定</span>
                        </div>
                    </div>
                </div>
                
                <!-- 图片表格信息 -->
                <div class="am-g" style="margin-top: 20px;">
                    <div class="am-u-sm-12">
                        <form class="am-form">
                            <table class="am-table table-main">
                                <thead>
                                    <tr style="font-size: 18px">
                                        <th class="table-title">名称</th>
                                        <th class="table-title">创建时间</th>
                                        <th class="table-set">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">

                                </tbody>
                            </table>
                            <div class="am-cf">
                                <div class="am-fr" style="font-size: 14px;">
                                    <ul class="am-pagination tpl-pagination" id="pagination"></ul>
                                </div>
                            </div>
                            <hr>
                        </form>
                    </div>
                </div>
            </div>
            </div>
        </div>
                     
        <script src="../assets/js/jquery.min.js"></script>
        <script src="../assets/js/amazeui.min.js"></script>
        <script src="../assets/js/toast.js"></script>
        <script src="../assets/js/cropper.min.js" charset="utf-8"></script>
        <script src="../assets/js/custom_up_img.js" charset="utf-8"></script>
        <script src="../assets/js/jqPaginator.min.js"></script>
        <script>
            var $data = {
                pageNum : 1,// 当前页
                pageSize : 10// 每页显示多少数据
            }
            $(function() {
                onLoad();
            });
            function onLoad() {
                initPage($data.pageNum, $data.pageSize);
            }
            function initPage(pageNum, pageSize) {
                 $.ajax({
                     url : '/wechat/manager/get_wechat_material_image_list_page',
                     data: {
                         pageNum: pageNum,
                         pageSize:pageSize
                     },
                     type : 'POST',
                     dataType:'json',
                     success : function(res) {
                        console.log(res);
                        var trHtml = '';
                        $.each(res.data, function(index, item) {
                           trHtml += '<tr>'+
                                   '<td><img src="' + item.localImgUrl + '" style="height: 120px;border: 1px solid #eee;" /> ' + item.title + '</td>'+
                                   '<td style="height: 120px;line-height: 120px;">' + getCurrentDate(item.createTime) + '</td>'+
                                   ' <td style="height: 120px;line-height: 120px;">'+
                                   '<div style="font-size: 20px;cursor: pointer;" onclick="deleteMaterialImage( '+ item.id + ')">'+
                                   '<span class="am-icon-trash-o"></span>'+
                                   '</div>'+
                                   '</td>'+
                                   '</tr>';
                        });
                        $('#tableBody').html(trHtml);
                         $('#imageCount').html('（共' + res.totalCount + '条）')

                         loadPage(res.totalPage, res.pageNum, res.totalCount)
                    },
                    error : function(err) {
                        console.log(err);
                    }
                });
            }
            function deleteMaterialImage(id) {
                if(confirm("确认删除吗")){
                    $.ajax({
                        url : '/wechat/manager/delete_material_image',
                        data : {
                            materialImageId: id
                        },
                        type : 'POST',
                        dataType:'json',
                        success : function(res) {
                            if (res.success) {
                                showMessage('删除成功');
                                initPage($data.pageNum, $data.pageSize);
                            } else {
                                showMessage(res.msg)
                            }
                        },
                        error : function(err) {
                            showMessage("系统错误");
                        }
                    });
                }
            }
            // 加载分页信息（使用分页插件）
            function loadPage(pages, pageNum, total) {
                $.jqPaginator('#pagination', {
                    totalPages: pages,
                    visiblePages: 5,
                    currentPage: pageNum,
                    first: '<li class="first"><a href="javascript:;">首页</a></li>',
                    prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
                    next: '<li class="next"><a href="javascript:;">下一页</a></li>',
                    last: '<li class="last"><a href="javascript:;">末页</a></li>',
                    page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
                    onPageChange: function (num, type) {
                        $('#pagination').prepend('<li style="margin-right:20px;margin-left:20px;">总页数：' + pages + ' 页</li>');
                        $('#pagination').prepend('<li>总条数：' + total + ' 条</li>');
                        if (type == "change") {
                            $data.pageNum = num;
                            initPage(num, $data.pageSize);
                            loadPage(pages);
                        }
                    }
                });
            }
            // 将当前时间转换成 2017年10月01日 22:10:10 格式的时间字符串
            function getCurrentDate(){
                var oDate = new Date(),
                        oYear = oDate.getFullYear(),
                        oMonth = oDate.getMonth()+1,
                        oDay = oDate.getDate(),
                        oHour = oDate.getHours(),
                        oMin = oDate.getMinutes(),
                        oSen = oDate.getSeconds(),
                        oTime = oYear +'年'+ zeroFill(oMonth) +'月'+ zeroFill(oDay) +'日 '+ zeroFill(oHour) +':'+ zeroFill(oMin) +':'+zeroFill(oSen);//最后拼接时间
                return oTime;
            };
            // 补零
            function zeroFill(i){
                if (i >= 0 && i <= 9) {
                    return "0" + i;
                } else {
                    return i;
                }
            }
        </script>
    </body>
</html>